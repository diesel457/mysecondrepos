# dm-stripe

> Stripe payments

## Usage

### On server:

```coffee
expressApp.use require('dm-stripe/server')(options)
```

where `options` are:

```coffee
# [REQUIRED] Stripe private and public keys (get them from your stripe account)
keys:
  secret: 'ABC'
  publishable: 'DEF'

# Payments handling URL (specify if you have something else on this default route)
url: '/api/pay'

# Validate price for each payment type. This can be either a number (price)
# or an async function. You can skip validation completely (not recommended).
validation:
  'individual.normal': 9.99
  'individual.pro': 24.99
  'corporate': 999
  'donation': (req, price, meta, cb) ->
    if price > 100
      return cb 'Donation is too big'
    cb()

# Hooks to execute after the successful payment
hooks:

  'individual.normal': (req, auth, meta, cb) ->
    auth.setEach
      paid: Date.now()
      accountType: 'normal'
    cb()

  'individual.pro': (req, auth, meta, cb) ->
    auth.setEach
      paid: Date.now()
      accountType: 'pro'
    cb()

  'corporate': (req, auth, meta, cb) ->
    console.log 'Paid for corporate'
    cb()

  'donation': (req, auth, meta, cb) ->
    auth.setEach
      paid: Date.now()
      accountType: 'donated'
    cb()
```

### On client:

```coffee
app.component require('dm-stripe')
```

### In code:

```jade
// For payment types that have numeric price specified in 'validation'
// you need to simply specify the type:
view(is='dm-stripe' type='individual.pro')

// Payment types without numeric price specified in 'validation' have
// to have the 'price' param specified:
view(is='dm-stripe' type='donation' price='{{ 50.00 }}')

// Additional customization params:
view(is='dm-stripe' type='donation' price='{{ 25.00 }}'
    name='Donation'
    description='Help our project to grow'
    meta="{{ { company: #root._page.user.company, importance: 10 } }}"
    on-paid="console.log( 'PAID!' )")
```

## Licence

Private